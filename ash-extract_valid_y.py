import os
import csv
import numpy as np

def read_labels_file(file_path: str) -> np.array:
    """Reads the labels from the csv file and returns it as an array

    :param file_path: path to the csv file containing the labels to the files in the dataset
    :return: labels as a numpy array
    """
    with open(file_path, 'r') as f:
        f.readline()
        vals = f.readlines()

    data = np.empty(shape=(len(vals), 1), dtype=np.float32)

    for val in vals:
        val_split = val.split(",")
        data[int(val_split[0])] = val_split[1]

    return data

LABELS_FILE = 'train_kaggle.csv'
VALID_DATA_DIR = 'dataset/valid/'
labels = read_labels_file(LABELS_FILE)
indexes = np.array([int(file_name.split(".")[0]) for file_name in os.listdir(VALID_DATA_DIR)])

def get_y():

    y = dict()

    for idx, id in enumerate(indexes):
        # get X data for each file
        data_x = np.load(os.path.join(VALID_DATA_DIR, str(id)+".npy"))
        # add y for each file
        y[id] = int(labels[id][0])

    with open('valid_y.csv', 'w') as csv_file:
        writer = csv.writer(csv_file)
        for key, value in y.items():
           writer.writerow([key, value])

get_y()
